<html>
    <head>
        <title>BS Plus Chat Integrations Manager</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

        <style>
            hr {
                border-top: 3px solid #ccc;
            }

            body {
                background-color: rgb(48, 48, 48);
                color: rgb(241, 241, 241);
            }

            button, select,
            input.form-control,
            .nav-tabs>li.active>a,
            .nav-tabs>li:hover>a {
                color:rgb(48, 48, 48);
            }

            .nav-tabs>li>a {
                color: #fff;
            }

            select, input.form-control, .nav-tabs>li.active>a {
                background-color: #f1f1f1;
            }

            input[disabled], .form-control[disabled] {
                background-color: #757575;
                color: #292929;
            }

            button {
                margin-right: 5px;
            }
        </style>
    </head>
    <body>
        <nav>
            <button class="btn btn-success" id="download">Big Download Button, definitly malicious ads, LicensedCrime &copy;</button>
        </nav>

        <br>
        <br>
        <br>

        <div class="container">
            <div class="col-md-6">
                <section id="event_create">
                    <h3>Create Event</h3>

                    <label for="event_type_select">Type:</label>
                    <select id="event_type_select">
                        <option value="1">ChatBits</option>
                        <option value="2">ChatCommand</option>
                        <option value="3">ChatFollow</option>
                        <option value="4">ChatPointsReward</option>
                        <option value="5">ChatSubscription</option>
                        <option value="6">Dummy</option>
                        <option value="7">LevelEnded</option>
                        <option value="8">LevelStarted</option>
                        <option value="9">VoiceAttackCommand</option>
                    </select>
                    
                    <hr>
                    <form>
                        <div class="form-group">
                            <label for="edit_event">Template</label>
                            <input type="text" class="form-control" id="edit_event" value="">
                        </div>
                    </form>
                    <hr>
        
                    <button class="btn btn-success" id="create_event_btn">Create</button>
                    <button class="btn btn-default" id="cancel_create_event_btn">Cancel</button>
                </section>

                <hr>
                <hr>
        
                <section id="event_manager">
                    <h3>Event List</h3>

                    <label for="event_filter">Filter:</label>
                    <select id="event_filter">
                        <option value="0" selected>All</option>
        
                        <option value="1">ChatBits</option>
                        <option value="2">ChatCommand</option>
                        <option value="3">ChatFollow</option>
                        <option value="4">ChatPointsReward</option>
                        <option value="5">ChatSubscription</option>
                        <option value="6">Dummy</option>
                        <option value="7">LevelEnded</option>
                        <option value="8">LevelStarted</option>
                        <option value="9">VoiceAttackCommand</option>
                    </select>
        
                    <hr>
        
                    <table>
                        <thead id="event_list_head">
                            <tr>
                                <th width="180">Type</th>
                                <th width="200">Template</th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="event_list_table">
                            <tr>
                                <td>{type}</td>
                                <td>{template}</td>
                                <td><button class="btn btn-primary" id="{event_edit_id}">Edit</button></td>
                                <td><button class="btn btn-danger" id="{event_delete_id}">Delete</button></td>
                            </tr>
                        </tbody>
                    </table>
        
                    <hr>
        
                    <div>
                        <button class="btn btn-success" id="new_btn">New</button>
                        <button class="btn btn-default" id="rename_btn">Rename</button>
                        <button class="btn btn-default" id="clone_btn">Clone</button>
                        <button class="btn btn-default" id="toggle_btn">Toggle</button>
                        <button class="btn btn-default" id="delete_btn" class="btn btn-danger">Delete</button>
                    </div>
                    <br>
                    <div>
                        <button class="btn btn-default" id="export_btn">Export</button>
                        <button class="btn btn-default" id="import_btn">Import</button>
                        <button class="btn btn-default" id="templates_btn" disabled>Templates</button>
                    </div>
                </section>
            </div>

            <!--  -->
            <div class="col-md-6">
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#trigger">Trigger</a></li>
                    <li><a data-toggle="tab" href="#actions">Actions</a></li>
                    <li><a data-toggle="tab" href="#conditions">Conditions</a></li>
                </ul>
                  
                <div class="tab-content">
                    <br>
                    <section id="trigger" class="tab-pane fade in active">
                        <h3>Trigger</h3>
                        <article id="trigger_article">

                        </article>
                    </section>

                    <section id="actions" class="tab-pane fade">
                        <h3>Actions</h3>
                        <hr>
                        <table>
                            <thead id="actions_list_head">
                                <tr>
                                    <th width="300">Type</th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="action_list_table">
                                <tr>
                                    <td>{type}</td>
                                    <td><button class="btn btn-primary" id="{action_edit_id}">Edit</button></td>
                                    <td><button class="btn btn-default" id="{action_clone_id}">Clone</button></td>
                                    <td><button class="btn btn-danger" id="{action_delete_id}">Delete</button></td>
                                </tr>
                            </tbody>

                        </table>

                        <hr>

                        <label for="action_type_select">Type:</label>
                        <select id="action_type_select">
                            <option value="1">Chat_SendMessage</option>
                            <option value="2">Chat_ToggleEmoteOnly</option>
                            <option value="3">EmoteRain_CustomRain</option>
                            <option value="4">EmoteRain_EmoteBombRain</option>
                            <option value="5">EmoteRain_SubRain</option>
                            <option value="6">Event_ExecuteDummy</option>
                            <option value="7">Event_Toggle</option>
                            <option value="8">GamePlay_Pause</option>
                            <option value="9">GamePlay_Quit</option>
                            <option value="10">GamePlay_ChangeDebris</option>
                            <option value="11">GamePlay_ChangeLightIntensity</option>
                            <option value="12">GamePlay_ChangeMusicVolume</option>
                            <option value="13">GamePlay_Restart</option>
                            <option value="14">GamePlay_SpawnSquatWalls</option>
                            <option value="15">GamePlay_ToggleHUD</option>
                            <option value="16">Misc_Delay</option>
                            <option value="17">Misc_PlaySound</option>
                            <option value="18">Twitch_AddMarker</option>
                            <option value="19">Twitch_CreateClip</option>
                        </select>
                        <div>
                            <button class="btn btn-success" id="create_action_btn">Add</button>
                        </div>
                        <br>
                        <article id="action_article">

                        </article>
                    </section>

                    <section id="conditions" class="tab-pane fade">
                        <h3>Conditions</h3>
                        <hr>
                        <table>
                            <thead id="conditions_list_head">
                                <tr>
                                    <th width="300">Type</th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="condition_list_table">
                                <tr>
                                    <td>{type}</td>
                                    <td><button class="btn btn-primary" id="{condition_edit_id}">Edit</button></td>
                                    <td><button class="btn btn-default" id="{condition_clone_id}">Clone</button></td>
                                    <td><button class="btn btn-danger" id="{condition_delete_id}">Delete</button></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <hr>
                        <label for="condition_type_select">Type:</label>
                        <select id="condition_type_select">
                            <option value="1">Bits_Amount</option>
                            <option value="2">ChatRequest_QueueDuration</option>
                            <option value="3">ChatRequest_QueueSize</option>
                            <option value="4">ChatRequest_QueueStatus</option>
                            <option value="5">GamePlay_InMenu</option>
                            <option value="6">GamePlay_LevelEndType</option>
                            <option value="7">GamePlay_PlayingMap</option>
                            <option value="8">Misc_Cooldown</option>
                            <option value="9">Subscription_IsGift</option>
                            <option value="10">Subscription_PlanType</option>
                            <option value="11">Subscription_PurchasedMonthCount</option>
                            <option value="12">User_Permissions</option>
                        </select>
                        <div>
                            <button class="btn btn-success" id="create_condition_btn">Add</button>
                        </div>
                        <hr>
                        <article id="condition_article">

                        </article>
                    </section>

                    <hr>
                    <div>
                        <button class="btn btn-success" id="save_settings_btn">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>


        <!--  -->

        <script src="js/Loader.js"></script>

        <script>
            include("SettingsGenerator");
            include("ViewController");
        </script>

        <script>


            function download(filename, text) {
                var element = document.createElement('a');
                element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
                element.setAttribute('download', filename);

                element.style.display = 'none';
                document.body.appendChild(element);

                element.click();

                document.body.removeChild(element);
            }
        </script>

        <script>
            var new_btn = document.getElementById("new_btn");
            var rename_btn = document.getElementById("rename_btn");
            var toggle_btn = document.getElementById("toggle_btn");
            var delete_btn = document.getElementById("delete_btn");
            var export_btn = document.getElementById("export_btn");
            var import_btn = document.getElementById("import_btn");
            var clone_btn = document.getElementById("clone_btn");
            var templates_btn = document.getElementById("templates_btn");

            var event_type_select = document.getElementById("event_type_select");
            var condition_type_select = document.getElementById("condition_type_select");

            var create_event_btn = document.getElementById("create_event_btn");
            var cancel_create_event_btn = document.getElementById("cancel_create_event_btn");

            var create_condition_btn = document.getElementById("create_condition_btn");
            var create_action_btn = document.getElementById("create_action_btn");

            var save_settings_btn = document.getElementById("save_settings_btn");

            var download_btn = document.getElementById("download");
        </script>

        <script>
            var event_create = document.getElementById("event_create");
            var event_manager = document.getElementById("event_manager");

            var edit_event = document.getElementById("edit_event");

            // ----

            var json = {};
            // ----

            onload(function() {
                var view = new ViewController();

                // -----------------------------------
                //removeChildren(trigger_article);
                // -----------------------------------

                var gen = new SettingsGenerator();

                json = gen.getJSON();

                create_event_btn.onclick = function() {
                    try {
                        var index = gen.addEvent(edit_event.value, parseInt(event_type_select.value));
                        view.showEvents(json);
    
                        view.showAction(index, -1);
                        view.showCondition(index, -1);
    
                        view.setCurrentEvent(index);
                    } catch(e) {
                        alert(e);
                    }
                };

                download_btn.onclick = function() {
                    download("ChatIntegrations.json", gen.getJSONString());
                };

                create_condition_btn.onclick = function() {
                    try {
                        var condition = parseInt(condition_type_select.value);
    
                        var index = gen.addCondition(view.getCurrentEvent(), condition);
                        view.showCondition(view.getCurrentEvent(), index);
                    } catch(e) {
                        console.log(e);
                        alert(e);
                    }
                };

                create_action_btn.onclick = function() {
                    try {
                        var action = parseInt(action_type_select.value);
    
                        var index = gen.addAction(view.getCurrentEvent(), action);
                        view.showAction(view.getCurrentEvent(), index);
                    } catch(e) {
                        console.log(e);
                        alert(e);
                    }
                };

                document.ondragover = function(e) { e.preventDefault(); };
                document.ondrop = function(e) {
                    e.preventDefault();

                    var file = e.dataTransfer.files[0];
                    var reader = new FileReader();

                    reader.onload = function(e) {
                        var data = e.target.result;

                        gen.import(data);
                        json = gen.getJSON();

                        view.showEvents(json);
                        view.showAction(0, -1);
                        view.showCondition(0, -1);
                    };

                    reader.readAsText(file);
                };
            });
        </script>
    </body>
</html>